version: '2'
services:
  consumer_frontend:
    image: "polyswarm/consumer"
    ports:
      - "12322:12322"
    environment:
      - PYTHONUNBUFFERED=1
      - REDIS_ADDR=redis:6379
      - KEYFILE=docker/consumer_keyfile
    command:
      - "dockerize"
      - "-wait"
      - "tcp://polyswarmd:31337"
      - "-timeout"
      - "1000s"
      - "-wait"
      - "tcp://redis:6379"
      - "-timeout"
      - "1000s"
      - "consumer"
      - "frontend"
      - "--polyswarmd-addr"
      - "polyswarmd:31337"
      - "--insecure-transport"
  consumer_backend:
    image: "polyswarm/consumer"
    environment:
      - PYTHONUNBUFFERED=1
      - KEYFILE=docker/consumer_keyfile
      - PASSWORD=password
      - CHAIN=side
      - REDIS_ADDR=redis:6379
    command:
      - "dockerize"
      - "-wait"
      - "tcp://redis:6379"
      - "-wait"
      - "tcp://polyswarmd:31337"
      - "-timeout"
      - "1000s"
      - "consumer"
      - "backend"
      - "--polyswarmd-addr"
      - "polyswarmd:31337"
      - "--insecure-transport"
  deposit-consumer:
    image: "polyswarm/polyswarm-client"
    depends_on:
      - polyswarmd
    environment:
      - PYTHONUNBUFFERED=1
      - KEYFILE=docker/consumer_keyfile
      - PASSWORD=password
    command:
      - "dockerize"
      - "-wait"
      - "tcp://polyswarmd:31337"
      - "-timeout"
      - "1000s"
      - "balancemanager"
      - "deposit"
      - "--polyswarmd-addr"
      - "polyswarmd:31337"
      - "--insecure-transport"
      - "20000000"
  redis:
    image: "redis"
    environment:
      - ALLOW_EMPTY_PASSWORD=yes
    ports:
      - '6379:6379'
